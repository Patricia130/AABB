workflows:
  android-native-release:
    name: Build Android Nativo - Codemagic
    max_build_duration: 60
    environment:
      vars:
        BUILD_DIR: android
      java: 17

    cache:
      cache_paths:
        - ~/.gradle/caches
        - ~/.gradle/wrapper

    scripts:
      - name: ğŸ” Localizar Gradlew
        script: |
          echo "ğŸ” Procurando arquivo gradlew..."
          GRADLEW_PATH=$(find . -type f -name "gradlew" | head -n 1)
          if [ -z "$GRADLEW_PATH" ]; then
            echo "âŒ Nenhum arquivo gradlew encontrado!"
            exit 1
          fi
          echo "âœ… gradlew encontrado em: $GRADLEW_PATH"
          chmod +x "$GRADLEW_PATH"

      - name: ğŸ§¹ Limpar projeto
        script: |
          echo "ğŸ§¹ Executando clean..."
          ./$(find . -type f -name "gradlew" | head -n 1 | sed 's|^\./||') clean

      - name: ğŸ—ï¸ Compilar APK Release
        script: |
          echo "ğŸ—ï¸ Iniciando build release..."
          ./$(find . -type f -name "gradlew" | head -n 1 | sed 's|^\./||') assembleRelease

    artifacts:
      - "**/build/outputs/**/*.apk"
      - "**/build/outputs/**/*.aab"

    publishing:
      email:
        recipients:
          - seuemail@exemplo.com
