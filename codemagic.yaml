workflows:
  android-native-release:
    name: To Chegando Cliente - Build Release
    instance_type: mac_mini_m1
    max_build_duration: 60

    environment:
      vars:
        JAVA_VERSION: 17
        ANDROID_SDK_VERSION: 34
        GRADLE_OPTS: "-Xmx4096m"

    scripts:
      - name: ğŸ” Localizar gradlew automaticamente
        script: |
          echo "ğŸ” Procurando o gradlew..."
          export GRADLEW_PATH=$(find . -type f -name "gradlew" | head -n 1)
          if [ -z "$GRADLEW_PATH" ]; then
            echo "âŒ ERRO: Arquivo gradlew nÃ£o encontrado!"
            exit 1
          fi
          echo "âœ… gradlew encontrado em: $GRADLEW_PATH"
          chmod +x "$GRADLEW_PATH"

      - name: ğŸ§¹ Limpar projeto
        script: |
          echo "ğŸ§¹ Executando clean..."
          bash "$GRADLEW_PATH" clean

      - name: ğŸ“¦ Build Release APK
        script: |
          echo "âš™ï¸ Gerando APK de release..."
          bash "$GRADLEW_PATH" assembleRelease

      - name: ğŸ“¦ Build Release AAB
        script: |
          echo "âš™ï¸ Gerando AAB de release..."
          bash "$GRADLEW_PATH" bundleRelease

    artifacts:
      - app/build/outputs/apk/release/*.apk
      - app/build/outputs/bundle/release/*.aab

    publishing:
      email:
        recipients:
          - seuemail@dominio.com
        notify:
          success: true
          failure: true
