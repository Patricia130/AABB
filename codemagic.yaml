# codemagic.yaml
#
# ConfiguraÃ§Ã£o completa para build de um projeto Android Nativo no Codemagic.
# Este workflow gera os artefatos APK e AAB em modo release.

workflows:
  android-native-release:
    name: TÃ´ Chegando Cliente - Build Release
    instance_type: mac_mini_m1
    max_build_duration: 60

    environment:
      vars:
        JAVA_VERSION: 17
        ANDROID_SDK_VERSION: 34

    scripts:
      - name: âš™ï¸ Configurar permissÃµes do Gradle Wrapper
        script: | 
          echo "âœ… Concedendo permissÃ£o de execuÃ§Ã£o para o gradlew..."
          chmod +x ./gradlew

      - name: ğŸ§¹ Limpar o projeto (Clean)
        script: | 
          echo "âš™ï¸ Executando a tarefa 'clean' do Gradle..."
          ./gradlew clean

      - name: ğŸ“¦ Gerar APK de Release
        script: | 
          echo "âš™ï¸ Compilando e gerando o APK de release..."
          ./gradlew assembleRelease

      - name: ğŸ“¦ Gerar AAB de Release (Bundle)
        script: | 
          echo "âš™ï¸ Compilando e gerando o AAB de release..."
          ./gradlew bundleRelease

    artifacts:
      - "app/build/outputs/apk/release/app-release.apk"
      - "app/build/outputs/bundle/release/app-release.aab"

    publishing:
      email:
        recipients:
          - seuemail@dominio.com
        notify:
          success: true
          failure: true
